{"ast":null,"code":"import _regeneratorRuntime from \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\nimport _applyDecoratedDescriptor from \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/applyDecoratedDescriptor\";\n\nvar _class;\n\n(function () {\n  var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;\n  enterModule && enterModule(module);\n})();\n\nvar __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {\n  return a;\n};\n\nimport { PublicService } from '@makerdao/services-core';\nimport { ServiceRoles } from './constants';\nimport { USDFL } from './index';\nimport BigNumber from 'bignumber.js';\nimport { RAY, WAD, SECONDS_PER_YEAR } from './constants';\nimport tracksTransactions from './utils/tracksTransactions';\nimport { getDsrEventHistory } from './EventHistory';\nvar SavingsService = (_class = /*#__PURE__*/function (_PublicService) {\n  _inherits(SavingsService, _PublicService);\n\n  var _super = _createSuper(SavingsService);\n\n  function SavingsService() {\n    var name = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : ServiceRoles.SAVINGS;\n\n    _classCallCheck(this, SavingsService);\n\n    return _super.call(this, name, ['smartContract', 'proxy', 'accounts', 'web3', ServiceRoles.SYSTEM_DATA]);\n  }\n\n  _createClass(SavingsService, [{\n    key: \"join\",\n    value: function () {\n      var _join = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(amountInDai, _ref) {\n        var promise;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                promise = _ref.promise;\n                _context.next = 3;\n                return this.get('proxy').ensureProxy();\n\n              case 3:\n                return _context.abrupt(\"return\", this._proxyActions.join(this._daiAdapterAddress, this._pot.address, amountInDai.toFixed('wei'), {\n                  dsProxy: true,\n                  promise: promise\n                }));\n\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function join(_x, _x2) {\n        return _join.apply(this, arguments);\n      }\n\n      return join;\n    }()\n  }, {\n    key: \"exit\",\n    value: function () {\n      var _exit = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(amountInDai, _ref2) {\n        var promise;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                promise = _ref2.promise;\n                _context2.next = 3;\n                return this.get('proxy').ensureProxy();\n\n              case 3:\n                return _context2.abrupt(\"return\", this._proxyActions.exit(this._daiAdapterAddress, this._pot.address, amountInDai.toFixed('wei'), {\n                  dsProxy: true,\n                  promise: promise\n                }));\n\n              case 4:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function exit(_x3, _x4) {\n        return _exit.apply(this, arguments);\n      }\n\n      return exit;\n    }()\n  }, {\n    key: \"exitAll\",\n    value: function () {\n      var _exitAll = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(_ref3) {\n        var promise;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                promise = _ref3.promise;\n                _context3.next = 3;\n                return this.get('proxy').ensureProxy();\n\n              case 3:\n                return _context3.abrupt(\"return\", this._proxyActions.exitAll(this._daiAdapterAddress, this._pot.address, {\n                  dsProxy: true,\n                  promise: promise\n                }));\n\n              case 4:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function exitAll(_x5) {\n        return _exitAll.apply(this, arguments);\n      }\n\n      return exitAll;\n    }()\n  }, {\n    key: \"balance\",\n    value: function () {\n      var _balance = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n        var proxy;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.next = 2;\n                return this.get('proxy').currentProxy();\n\n              case 2:\n                proxy = _context4.sent;\n                return _context4.abrupt(\"return\", proxy ? this.balanceOf(proxy) : USDFL(0));\n\n              case 4:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function balance() {\n        return _balance.apply(this, arguments);\n      }\n\n      return balance;\n    }()\n  }, {\n    key: \"balanceOf\",\n    value: function () {\n      var _balanceOf = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(guy) {\n        var slice, chi;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _context5.t0 = BigNumber;\n                _context5.next = 3;\n                return this._pot.pie(guy);\n\n              case 3:\n                _context5.t1 = _context5.sent;\n                slice = new _context5.t0(_context5.t1);\n                _context5.next = 7;\n                return this.chi();\n\n              case 7:\n                chi = _context5.sent;\n                return _context5.abrupt(\"return\", USDFL(slice.times(chi).div(WAD).dp(18)));\n\n              case 9:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function balanceOf(_x6) {\n        return _balanceOf.apply(this, arguments);\n      }\n\n      return balanceOf;\n    }()\n  }, {\n    key: \"getTotalDai\",\n    value: function () {\n      var _getTotalDai = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6() {\n        var totalPie, chi;\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _context6.t0 = BigNumber;\n                _context6.next = 3;\n                return this._pot.Pie();\n\n              case 3:\n                _context6.t1 = _context6.sent;\n                totalPie = new _context6.t0(_context6.t1);\n                _context6.next = 7;\n                return this.chi();\n\n              case 7:\n                chi = _context6.sent;\n                return _context6.abrupt(\"return\", USDFL(totalPie.times(chi).div(WAD).dp(18)));\n\n              case 9:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n\n      function getTotalDai() {\n        return _getTotalDai.apply(this, arguments);\n      }\n\n      return getTotalDai;\n    }()\n  }, {\n    key: \"getYearlyRate\",\n    value: function () {\n      var _getYearlyRate = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7() {\n        var dsr;\n        return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                _context7.t0 = BigNumber;\n                _context7.next = 3;\n                return this._pot.dsr();\n\n              case 3:\n                _context7.t1 = _context7.sent;\n                dsr = new _context7.t0(_context7.t1).div(RAY);\n                return _context7.abrupt(\"return\", dsr.pow(SECONDS_PER_YEAR).minus(1));\n\n              case 6:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n\n      function getYearlyRate() {\n        return _getYearlyRate.apply(this, arguments);\n      }\n\n      return getYearlyRate;\n    }()\n  }, {\n    key: \"chi\",\n    value: function () {\n      var _chi = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee8() {\n        return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                _context8.t0 = BigNumber;\n                _context8.next = 3;\n                return this._pot.chi();\n\n              case 3:\n                _context8.t1 = _context8.sent;\n                return _context8.abrupt(\"return\", new _context8.t0(_context8.t1).div(RAY));\n\n              case 5:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this);\n      }));\n\n      function chi() {\n        return _chi.apply(this, arguments);\n      }\n\n      return chi;\n    }()\n  }, {\n    key: \"getEventHistory\",\n    value: function getEventHistory(address) {\n      if (!this._eventHistoryCache) this._eventHistoryCache = {};\n      return getDsrEventHistory(this, address, this._eventHistoryCache);\n    }\n  }, {\n    key: \"getEarningsToDate\",\n    value: function () {\n      var _getEarningsToDate = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee9(address) {\n        var eventHistory, sum, balance;\n        return _regeneratorRuntime.wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                if (!this._eventHistoryCache) this._eventHistoryCache = {};\n                _context9.next = 3;\n                return getDsrEventHistory(this, address, this._eventHistoryCache);\n\n              case 3:\n                eventHistory = _context9.sent;\n                sum = new BigNumber(0);\n                eventHistory.forEach(function (_ref4) {\n                  var type = _ref4.type,\n                      amount = _ref4.amount;\n                  if (type === 'DSR_DEPOSIT') sum = sum.plus(amount);\n                  if (type === 'DSR_WITHDRAW') sum = sum.minus(amount);\n                });\n                _context9.next = 8;\n                return this.balanceOf(address);\n\n              case 8:\n                balance = _context9.sent;\n                return _context9.abrupt(\"return\", balance.gt(sum) ? balance.minus(sum) : USDFL(0));\n\n              case 10:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9, this);\n      }));\n\n      function getEarningsToDate(_x7) {\n        return _getEarningsToDate.apply(this, arguments);\n      }\n\n      return getEarningsToDate;\n    }()\n  }, {\n    key: \"resetEventHistoryCache\",\n    value: function resetEventHistoryCache() {\n      var address = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n      if (address !== null) delete this._eventHistoryCache[address];else this._eventHistoryCache = {};\n    }\n  }, {\n    key: \"__reactstandin__regenerateByEval\",\n    // @ts-ignore\n    value: function __reactstandin__regenerateByEval(key, code) {\n      // @ts-ignore\n      this[key] = eval(code);\n    }\n  }, {\n    key: \"_proxyActions\",\n    get: function get() {\n      return this.get('smartContract').getContract('PROXY_ACTIONS_DSR');\n    }\n  }, {\n    key: \"_pot\",\n    get: function get() {\n      return this.get('smartContract').getContract('MCD_POT');\n    }\n  }, {\n    key: \"_daiAdapterAddress\",\n    get: function get() {\n      return this.get(ServiceRoles.SYSTEM_DATA).adapterAddress('USDFL');\n    }\n  }]);\n\n  return SavingsService;\n}(PublicService), (_applyDecoratedDescriptor(_class.prototype, \"join\", [tracksTransactions], Object.getOwnPropertyDescriptor(_class.prototype, \"join\"), _class.prototype), _applyDecoratedDescriptor(_class.prototype, \"exit\", [tracksTransactions], Object.getOwnPropertyDescriptor(_class.prototype, \"exit\"), _class.prototype), _applyDecoratedDescriptor(_class.prototype, \"exitAll\", [tracksTransactions], Object.getOwnPropertyDescriptor(_class.prototype, \"exitAll\"), _class.prototype)), _class);\nexport { SavingsService as default };\n;\n\n(function () {\n  var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;\n\n  if (!reactHotLoader) {\n    return;\n  }\n\n  reactHotLoader.register(SavingsService, \"SavingsService\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/libs/dai-plugin-mcd/src/SavingsService.js\");\n})();\n\n;\n\n(function () {\n  var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;\n  leaveModule && leaveModule(module);\n})();","map":{"version":3,"sources":["/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/libs/dai-plugin-mcd/src/SavingsService.js"],"names":["PublicService","ServiceRoles","USDFL","BigNumber","RAY","WAD","SECONDS_PER_YEAR","tracksTransactions","getDsrEventHistory","SavingsService","name","SAVINGS","SYSTEM_DATA","amountInDai","promise","get","ensureProxy","_proxyActions","join","_daiAdapterAddress","_pot","address","toFixed","dsProxy","exit","exitAll","currentProxy","proxy","balanceOf","guy","pie","slice","chi","times","div","dp","Pie","totalPie","dsr","pow","minus","_eventHistoryCache","eventHistory","sum","forEach","type","amount","plus","balance","gt","getContract","adapterAddress"],"mappings":"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","sourcesContent":["import { PublicService } from '@makerdao/services-core';\nimport { ServiceRoles } from './constants';\nimport { USDFL } from './index';\nimport BigNumber from 'bignumber.js';\nimport { RAY, WAD, SECONDS_PER_YEAR } from './constants';\nimport tracksTransactions from './utils/tracksTransactions';\nimport { getDsrEventHistory } from './EventHistory';\n\nexport default class SavingsService extends PublicService {\n  constructor(name = ServiceRoles.SAVINGS) {\n    super(name, [\n      'smartContract',\n      'proxy',\n      'accounts',\n      'web3',\n      ServiceRoles.SYSTEM_DATA\n    ]);\n  }\n\n  @tracksTransactions\n  async join(amountInDai, { promise }) {\n    await this.get('proxy').ensureProxy();\n\n    return this._proxyActions.join(\n      this._daiAdapterAddress,\n      this._pot.address,\n      amountInDai.toFixed('wei'),\n      { dsProxy: true, promise }\n    );\n  }\n\n  @tracksTransactions\n  async exit(amountInDai, { promise }) {\n    await this.get('proxy').ensureProxy();\n\n    return this._proxyActions.exit(\n      this._daiAdapterAddress,\n      this._pot.address,\n      amountInDai.toFixed('wei'),\n      { dsProxy: true, promise }\n    );\n  }\n\n  @tracksTransactions\n  async exitAll({ promise }) {\n    await this.get('proxy').ensureProxy();\n\n    return this._proxyActions.exitAll(\n      this._daiAdapterAddress,\n      this._pot.address,\n      { dsProxy: true, promise }\n    );\n  }\n\n  async balance() {\n    const proxy = await this.get('proxy').currentProxy();\n\n    return proxy ? this.balanceOf(proxy) : USDFL(0);\n  }\n\n  async balanceOf(guy) {\n    const slice = new BigNumber(await this._pot.pie(guy));\n    const chi = await this.chi();\n    return USDFL(\n      slice\n        .times(chi)\n        .div(WAD)\n        .dp(18)\n    );\n  }\n\n  async getTotalDai() {\n    const totalPie = new BigNumber(await this._pot.Pie());\n    const chi = await this.chi();\n    return USDFL(\n      totalPie\n        .times(chi)\n        .div(WAD)\n        .dp(18)\n    );\n  }\n\n  async getYearlyRate() {\n    const dsr = new BigNumber(await this._pot.dsr()).div(RAY);\n    return dsr.pow(SECONDS_PER_YEAR).minus(1);\n  }\n\n  async chi() {\n    return new BigNumber(await this._pot.chi()).div(RAY);\n  }\n\n  get _proxyActions() {\n    return this.get('smartContract').getContract('PROXY_ACTIONS_DSR');\n  }\n\n  get _pot() {\n    return this.get('smartContract').getContract('MCD_POT');\n  }\n\n  get _daiAdapterAddress() {\n    return this.get(ServiceRoles.SYSTEM_DATA).adapterAddress('USDFL');\n  }\n\n  getEventHistory(address) {\n    if (!this._eventHistoryCache) this._eventHistoryCache = {};\n    return getDsrEventHistory(this, address, this._eventHistoryCache);\n  }\n\n  async getEarningsToDate(address) {\n    if (!this._eventHistoryCache) this._eventHistoryCache = {};\n    const eventHistory = await getDsrEventHistory(\n      this,\n      address,\n      this._eventHistoryCache\n    );\n    let sum = new BigNumber(0);\n    eventHistory.forEach(({ type, amount }) => {\n      if (type === 'DSR_DEPOSIT') sum = sum.plus(amount);\n      if (type === 'DSR_WITHDRAW') sum = sum.minus(amount);\n    });\n    const balance = await this.balanceOf(address);\n    return balance.gt(sum) ? balance.minus(sum) : USDFL(0);\n  }\n\n  resetEventHistoryCache(address = null) {\n    if (address !== null) delete this._eventHistoryCache[address];\n    else this._eventHistoryCache = {};\n  }\n}\n"]},"metadata":{},"sourceType":"module"}