{"ast":null,"code":"import _regeneratorRuntime from \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _createForOfIteratorHelper from \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";\nimport _objectWithoutProperties from \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _classCallCheck from \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\n\n(function () {\n  var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;\n  enterModule && enterModule(module);\n})();\n\nvar __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {\n  return a;\n};\n\nimport DefaultServiceProvider, { resolver } from './config/DefaultServiceProvider';\nimport ConfigFactory from './config/ConfigFactory';\nimport mergeWith from 'lodash/mergeWith';\nimport cloneDeep from 'lodash/cloneDeep';\nimport uniq from 'lodash/uniq';\nimport has from 'lodash/has';\nimport assert from 'assert'; // a plugin must be either an object with at least one of these keys defined, or\n// a single function, which will be treated as the value for `afterCreate`.\n\nvar PLUGIN_KEYS = ['beforeCreate', 'afterCreate', 'addConfig'];\n/**\n * do not call `new Maker()` directly; use `Maker.create` instead\n */\n\nvar Maker = /*#__PURE__*/function () {\n  function Maker(preset) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var userOptions = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n    _classCallCheck(this, Maker);\n\n    var _options$plugins = options.plugins,\n        plugins = _options$plugins === void 0 ? [] : _options$plugins,\n        otherOptions = _objectWithoutProperties(options, [\"plugins\"]);\n\n    var _iterator = _createForOfIteratorHelper(plugins),\n        _step;\n\n    try {\n      for (_iterator.s(); !(_step = _iterator.n()).done;) {\n        var _step$value = _slicedToArray(_step.value, 2),\n            plugin = _step$value[0],\n            pluginOptions = _step$value[1];\n\n        if (plugin.addConfig) {\n          mergeOptions(otherOptions, plugin.addConfig(otherOptions, pluginOptions));\n        }\n      } // This ensures user supplied config options always take priority\n\n    } catch (err) {\n      _iterator.e(err);\n    } finally {\n      _iterator.f();\n    }\n\n    if (plugins && userOptions) mergeOptions(otherOptions, userOptions);\n    var config = ConfigFactory.create(preset, otherOptions, resolver);\n    this._container = new DefaultServiceProvider(config).buildContainer();\n\n    var _iterator2 = _createForOfIteratorHelper(plugins),\n        _step2;\n\n    try {\n      for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n        var _step2$value = _slicedToArray(_step2.value, 2),\n            _plugin = _step2$value[0],\n            _pluginOptions = _step2$value[1];\n\n        if (_plugin.afterCreate) _plugin.afterCreate(this, config, _pluginOptions);\n      }\n    } catch (err) {\n      _iterator2.e(err);\n    } finally {\n      _iterator2.f();\n    }\n\n    if (otherOptions.autoAuthenticate !== false) this.authenticate();\n    delegateToServices(this, {\n      accounts: ['addAccount', 'currentAccount', 'currentAddress', 'listAccounts', 'useAccount', 'useAccountWithAddress'],\n      cdp: ['getCdp', 'openCdp', 'getCdpIds'],\n      event: ['on'],\n      proxy: ['currentProxy'],\n      token: ['getToken'],\n      multicall: ['watch', 'latest']\n    });\n  }\n\n  _createClass(Maker, [{\n    key: \"authenticate\",\n    value: function authenticate() {\n      if (!this._authenticatedPromise) {\n        this._authenticatedPromise = this._container.authenticate();\n      }\n\n      return this._authenticatedPromise;\n    } // skipAuthCheck should only be set if you're sure you don't need the service\n    // to be initialized yet, e.g. when setting up a plugin\n\n  }, {\n    key: \"service\",\n    value: function service(_service) {\n      var skipAuthCheck = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      var skipAuthCheckForServices = ['event'];\n\n      if (!skipAuthCheck && !this._container.isAuthenticated && !skipAuthCheckForServices.includes(_service)) {\n        throw new Error(\"Can't use service \".concat(_service, \" before authenticate() has finished.\"));\n      }\n\n      return this._container.service(_service);\n    }\n  }, {\n    key: \"__reactstandin__regenerateByEval\",\n    // @ts-ignore\n    value: function __reactstandin__regenerateByEval(key, code) {\n      // @ts-ignore\n      this[key] = eval(code);\n    }\n  }]);\n\n  return Maker;\n}();\n\nexport { Maker as default };\n\nfunction delegateToServices(maker, services) {\n  var _loop = function _loop(serviceName) {\n    var _iterator3 = _createForOfIteratorHelper(services[serviceName]),\n        _step3;\n\n    try {\n      var _loop2 = function _loop2() {\n        var methodName = _step3.value;\n\n        if (serviceName === 'cdp') {\n          maker[methodName] = function () {\n            throw new Error(\"\\\"\".concat(methodName, \"\\\" is no longer available here. Add @makerdao/dai-plugin-scd, then use maker.service('cdp').\").concat(methodName));\n          };\n        } else {\n          maker[methodName] = function () {\n            var _maker$service;\n\n            return (_maker$service = maker.service(serviceName))[methodName].apply(_maker$service, arguments);\n          };\n        }\n      };\n\n      for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n        _loop2();\n      }\n    } catch (err) {\n      _iterator3.e(err);\n    } finally {\n      _iterator3.f();\n    }\n  };\n\n  for (var serviceName in services) {\n    _loop(serviceName);\n  }\n}\n\nfunction mergeOptions(object, source) {\n  return mergeWith(object, source, function (objValue, srcValue, key) {\n    if (Array.isArray(objValue) && key === 'abi') return uniq(objValue);\n    if (Array.isArray(objValue) && key !== 'abi') return uniq(objValue.concat(srcValue)); // when this function returns undefined, mergeWith falls back to the\n    // default merging behavior.\n    // https://devdocs.io/lodash~4/index#mergeWith\n  });\n}\n\nMaker.create = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n  var _len,\n      args,\n      _key,\n      preset,\n      _args$,\n      options,\n      plugins,\n      otherOptions,\n      userOptions,\n      _iterator4,\n      _step4,\n      _step4$value,\n      p,\n      popts,\n      maker,\n      _args = arguments;\n\n  return _regeneratorRuntime.wrap(function _callee$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          for (_len = _args.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n            args[_key] = _args[_key];\n          }\n\n          preset = args[0], _args$ = args[1], options = _args$ === void 0 ? {} : _args$;\n          plugins = options.plugins, otherOptions = _objectWithoutProperties(options, [\"plugins\"]); // Preserve the user supplied options to apply after plugins are executed.\n\n          userOptions = cloneDeep(otherOptions);\n\n          if (!plugins) {\n            _context.next = 28;\n            break;\n          }\n\n          options.plugins = standardizePluginConfig(plugins);\n          _iterator4 = _createForOfIteratorHelper(options.plugins);\n          _context.prev = 7;\n\n          _iterator4.s();\n\n        case 9:\n          if ((_step4 = _iterator4.n()).done) {\n            _context.next = 20;\n            break;\n          }\n\n          _step4$value = _slicedToArray(_step4.value, 2), p = _step4$value[0], popts = _step4$value[1];\n\n          if (!p.beforeCreate) {\n            _context.next = 18;\n            break;\n          }\n\n          _context.t0 = Object;\n          _context.t1 = options;\n          _context.next = 16;\n          return p.beforeCreate(popts);\n\n        case 16:\n          _context.t2 = _context.sent;\n\n          _context.t0.assign.call(_context.t0, _context.t1, _context.t2);\n\n        case 18:\n          _context.next = 9;\n          break;\n\n        case 20:\n          _context.next = 25;\n          break;\n\n        case 22:\n          _context.prev = 22;\n          _context.t3 = _context[\"catch\"](7);\n\n          _iterator4.e(_context.t3);\n\n        case 25:\n          _context.prev = 25;\n\n          _iterator4.f();\n\n          return _context.finish(25);\n\n        case 28:\n          maker = new Maker(preset, options, userOptions);\n\n          if (!(options.autoAuthenticate !== false)) {\n            _context.next = 32;\n            break;\n          }\n\n          _context.next = 32;\n          return maker.authenticate();\n\n        case 32:\n          return _context.abrupt(\"return\", maker);\n\n        case 33:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _callee, null, [[7, 22, 25, 28]]);\n}));\n\nvar standardizePluginConfig = function standardizePluginConfig(plugins) {\n  return plugins.map(function (x, i) {\n    var _ref2 = Array.isArray(x) ? x : [x, {}],\n        _ref3 = _slicedToArray(_ref2, 2),\n        plugin = _ref3[0],\n        pluginOptions = _ref3[1];\n\n    if (typeof plugin === 'function') plugin = {\n      afterCreate: plugin\n    };\n    assert(PLUGIN_KEYS.some(function (x) {\n      return has(plugin, x);\n    }), \"plugins[\".concat(i, \"] does not seem to be a plugin\"));\n    return [plugin, pluginOptions];\n  });\n};\n\n;\n\n(function () {\n  var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;\n\n  if (!reactHotLoader) {\n    return;\n  }\n\n  reactHotLoader.register(PLUGIN_KEYS, \"PLUGIN_KEYS\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/libs/dai/src/Maker.js\");\n  reactHotLoader.register(Maker, \"Maker\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/libs/dai/src/Maker.js\");\n  reactHotLoader.register(delegateToServices, \"delegateToServices\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/libs/dai/src/Maker.js\");\n  reactHotLoader.register(mergeOptions, \"mergeOptions\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/libs/dai/src/Maker.js\");\n  reactHotLoader.register(standardizePluginConfig, \"standardizePluginConfig\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/libs/dai/src/Maker.js\");\n})();\n\n;\n\n(function () {\n  var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;\n  leaveModule && leaveModule(module);\n})();","map":{"version":3,"sources":["/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/libs/dai/src/Maker.js"],"names":["DefaultServiceProvider","resolver","ConfigFactory","mergeWith","cloneDeep","uniq","has","assert","PLUGIN_KEYS","Maker","preset","options","userOptions","plugins","otherOptions","plugin","pluginOptions","addConfig","mergeOptions","config","create","_container","buildContainer","afterCreate","autoAuthenticate","authenticate","delegateToServices","accounts","cdp","event","proxy","token","multicall","_authenticatedPromise","service","skipAuthCheck","skipAuthCheckForServices","isAuthenticated","includes","Error","maker","services","serviceName","methodName","object","source","objValue","srcValue","key","Array","isArray","concat","args","standardizePluginConfig","p","popts","beforeCreate","Object","assign","map","x","i","some"],"mappings":"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","sourcesContent":["import DefaultServiceProvider, {\n  resolver\n} from './config/DefaultServiceProvider';\nimport ConfigFactory from './config/ConfigFactory';\nimport mergeWith from 'lodash/mergeWith';\nimport cloneDeep from 'lodash/cloneDeep';\nimport uniq from 'lodash/uniq';\nimport has from 'lodash/has';\nimport assert from 'assert';\n\n// a plugin must be either an object with at least one of these keys defined, or\n// a single function, which will be treated as the value for `afterCreate`.\nconst PLUGIN_KEYS = ['beforeCreate', 'afterCreate', 'addConfig'];\n\n/**\n * do not call `new Maker()` directly; use `Maker.create` instead\n */\nexport default class Maker {\n  constructor(preset, options = {}, userOptions = {}) {\n    const { plugins = [], ...otherOptions } = options;\n\n    for (const [plugin, pluginOptions] of plugins) {\n      if (plugin.addConfig) {\n        mergeOptions(\n          otherOptions,\n          plugin.addConfig(otherOptions, pluginOptions)\n        );\n      }\n    }\n    // This ensures user supplied config options always take priority\n    if (plugins && userOptions) mergeOptions(otherOptions, userOptions);\n\n    const config = ConfigFactory.create(preset, otherOptions, resolver);\n    this._container = new DefaultServiceProvider(config).buildContainer();\n\n    for (const [plugin, pluginOptions] of plugins) {\n      if (plugin.afterCreate) plugin.afterCreate(this, config, pluginOptions);\n    }\n\n    if (otherOptions.autoAuthenticate !== false) this.authenticate();\n\n    delegateToServices(this, {\n      accounts: [\n        'addAccount',\n        'currentAccount',\n        'currentAddress',\n        'listAccounts',\n        'useAccount',\n        'useAccountWithAddress'\n      ],\n      cdp: ['getCdp', 'openCdp', 'getCdpIds'],\n      event: ['on'],\n      proxy: ['currentProxy'],\n      token: ['getToken'],\n      multicall: ['watch', 'latest']\n    });\n  }\n\n  authenticate() {\n    if (!this._authenticatedPromise) {\n      this._authenticatedPromise = this._container.authenticate();\n    }\n    return this._authenticatedPromise;\n  }\n\n  // skipAuthCheck should only be set if you're sure you don't need the service\n  // to be initialized yet, e.g. when setting up a plugin\n  service(service, skipAuthCheck = false) {\n    const skipAuthCheckForServices = ['event'];\n    if (\n      !skipAuthCheck &&\n      !this._container.isAuthenticated &&\n      !skipAuthCheckForServices.includes(service)\n    ) {\n      throw new Error(\n        `Can't use service ${service} before authenticate() has finished.`\n      );\n    }\n    return this._container.service(service);\n  }\n}\n\nfunction delegateToServices(maker, services) {\n  for (const serviceName in services) {\n    for (const methodName of services[serviceName]) {\n      if (serviceName === 'cdp') {\n        maker[methodName] = () => {\n          throw new Error(`\"${methodName}\" is no longer available here. Add @makerdao/dai-plugin-scd, then use maker.service('cdp').${methodName}`);\n        }\n      } else {\n        maker[methodName] = (...args) =>\n          maker.service(serviceName)[methodName](...args);\n      }\n    }\n  }\n}\n\nfunction mergeOptions(object, source) {\n  return mergeWith(object, source, (objValue, srcValue, key) => {\n    if (Array.isArray(objValue) && key === 'abi') return uniq(objValue);\n\n    if (Array.isArray(objValue) && key !== 'abi')\n      return uniq(objValue.concat(srcValue));\n    // when this function returns undefined, mergeWith falls back to the\n    // default merging behavior.\n    // https://devdocs.io/lodash~4/index#mergeWith\n  });\n}\n\nMaker.create = async function(...args) {\n  const [preset, options = {}] = args;\n  const { plugins, ...otherOptions } = options;\n\n  // Preserve the user supplied options to apply after plugins are executed.\n  const userOptions = cloneDeep(otherOptions);\n\n  if (plugins) {\n    options.plugins = standardizePluginConfig(plugins);\n    for (const [p, popts] of options.plugins) {\n      // the beforeCreate function can return new options to be sent to the\n      // Maker constructor\n      if (p.beforeCreate) Object.assign(options, await p.beforeCreate(popts));\n    }\n  }\n\n  const maker = new Maker(preset, options, userOptions);\n  if (options.autoAuthenticate !== false) await maker.authenticate();\n  return maker;\n};\n\nconst standardizePluginConfig = plugins =>\n  plugins.map((x, i) => {\n    let [plugin, pluginOptions] = Array.isArray(x) ? x : [x, {}];\n    if (typeof plugin === 'function') plugin = { afterCreate: plugin };\n\n    assert(\n      PLUGIN_KEYS.some(x => has(plugin, x)),\n      `plugins[${i}] does not seem to be a plugin`\n    );\n\n    return [plugin, pluginOptions];\n  });\n"]},"metadata":{},"sourceType":"module"}