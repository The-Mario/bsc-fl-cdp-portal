{"ast":null,"code":"import _toConsumableArray from \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _slicedToArray from \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectWithoutProperties from \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/providers/TransactionManagerProvider.js\";\n\n(function () {\n  var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;\n  enterModule && enterModule(module);\n})();\n\nvar __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {\n  return a;\n};\n\nimport React, { createContext, useState } from 'react';\nimport { useEffect } from 'react';\nimport useMaker from 'hooks/useMaker';\nimport { prettifyCurrency } from 'utils/ui';\nimport useLanguage from 'hooks/useLanguage';\nimport { uniqueId } from 'utils/dev';\nimport findIndex from 'lodash/findIndex';\nimport { txManager } from 'references/config';\nimport styled from 'styled-components';\nvar autoDismissTime = txManager.autoDismissTime,\n    autoDismissFadeoutTime = txManager.autoDismissFadeoutTime;\nvar ValueText = styled.b.withConfig({\n  displayName: \"TransactionManagerProvider__ValueText\",\n  componentId: \"sc-1w0tar7-0\"\n})([\"font-weight:600;\"]);\n\nvar formatTxMessage = function formatTxMessage(lang, _ref, state) {\n  var _metadata$action;\n\n  var metadata = _ref.metadata,\n      tx = _objectWithoutProperties(_ref, [\"metadata\"]);\n\n  var interfaceLocale = lang.getInterfaceLanguage();\n\n  var formatAmount = function formatAmount(amount) {\n    return prettifyCurrency(interfaceLocale, amount.toBigNumber(), 2);\n  };\n\n  var type = (metadata === null || metadata === void 0 ? void 0 : metadata.method) || (metadata === null || metadata === void 0 ? void 0 : (_metadata$action = metadata.action) === null || _metadata$action === void 0 ? void 0 : _metadata$action.name);\n  var langKey = state === 'success' ? 'transactions_past_tense' : 'transactions';\n  var suffix = state === 'error' && tx.hash ? ' failed' : state === 'error' && !tx.hash ? ' cancelled' : '';\n  console.log(type);\n\n  switch (type) {\n    case 'safeWipe':\n      return lang.formatString(\"\".concat(lang[langKey].pay_back_dai).concat(suffix), /*#__PURE__*/React.createElement(ValueText, {\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 35,\n          columnNumber: 9\n        }\n      }, formatAmount(metadata.wipeAmount)));\n\n    case 'safeWipeAll':\n      return lang.formatString(\"\".concat(lang[langKey].pay_back_dai).concat(suffix), 'outstanding');\n\n    case 'draw':\n      return lang.formatString(\"\".concat(lang[langKey].generate_dai).concat(suffix), /*#__PURE__*/React.createElement(ValueText, {\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 45,\n          columnNumber: 9\n        }\n      }, formatAmount(metadata.drawAmount)));\n\n    case 'claimReward':\n      return lang.formatString(\"\".concat(lang[langKey].get_reward).concat(suffix), /*#__PURE__*/React.createElement(ValueText, {\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 50,\n          columnNumber: 9\n        }\n      }));\n\n    case 'claimRewardEx':\n      return lang.formatString(\"\".concat(lang[langKey].get_reward_all).concat(suffix), /*#__PURE__*/React.createElement(ValueText, {\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 55,\n          columnNumber: 9\n        }\n      }));\n\n    case 'getReward':\n      return lang.formatString(\"\".concat(lang[langKey].get_reward).concat(suffix), /*#__PURE__*/React.createElement(ValueText, {\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 60,\n          columnNumber: 9\n        }\n      }));\n\n    case 'withdraw':\n      return lang.formatString(\"\".concat(lang[langKey].unlock_pool).concat(suffix), /*#__PURE__*/React.createElement(ValueText, {\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 65,\n          columnNumber: 9\n        }\n      }));\n\n    case 'stake':\n      return lang.formatString(\"\".concat(lang[langKey].lock_pool).concat(suffix), /*#__PURE__*/React.createElement(ValueText, {\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 70,\n          columnNumber: 9\n        }\n      }));\n\n    case 'safeLockETH':\n    case 'safeLockGem':\n      return lang.formatString(\"\".concat(lang[langKey].depositing_gem).concat(suffix), /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(ValueText, {\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 77,\n          columnNumber: 11\n        }\n      }, formatAmount(metadata.lockAmount)), ' ', metadata.lockAmount.symbol));\n\n    case 'wipeAndFreeETH':\n    case 'wipeAndFreeGem':\n      return lang.formatString(\"\".concat(lang[langKey].withdrawing_gem).concat(suffix), /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(ValueText, {\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 86,\n          columnNumber: 11\n        }\n      }, formatAmount(metadata.freeAmount)), ' ', metadata.freeAmount.symbol));\n\n    case 'openLockETHAndDraw':\n    case 'openLockGemAndDraw':\n      return lang.formatString(\"\".concat(lang[langKey].creating_cdp).concat(suffix) // <><ValueText>{formatAmount(metadata.lockAmount)}</ValueText> {(lockAmount.symbol)}</>\n      );\n\n    case 'lockETHAndDraw':\n    case 'lockGemAndDraw':\n      return lang.formatString(\"\".concat(lang[langKey].deposit_generate).concat(suffix), /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(ValueText, {\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 101,\n          columnNumber: 11\n        }\n      }, formatAmount(metadata.drawAmount)), ' ', metadata.drawAmount.symbol));\n\n    case 'transfer':\n      return lang.formatString(\"\".concat(lang[langKey].send).concat(suffix), /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(ValueText, {\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 109,\n          columnNumber: 11\n        }\n      }, formatAmount(metadata.action.amount)), ' ', metadata.action.amount.symbol), /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(ValueText, {\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 113,\n          columnNumber: 11\n        }\n      }, metadata.action.to.toLowerCase().substr(0, 5)), \"...\", /*#__PURE__*/React.createElement(ValueText, {\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 115,\n          columnNumber: 11\n        }\n      }, metadata.action.to.toLowerCase().substr(-3))));\n\n    case 'build':\n      return lang.formatString(\"\".concat(lang[langKey].setting_up_proxy).concat(suffix));\n\n    case 'approve':\n      return lang.formatString(\"\".concat(lang[langKey].unlocking_token).concat(suffix), metadata.contract === 'MCD_DAI' ? 'USDFL' : 'token');\n\n    case 'join':\n      if (metadata.contract === 'PROXY_ACTIONS_DSR') return lang.formatString(\"\".concat(lang[langKey].depositing_gem).concat(suffix), 'USDFL');else return '?';\n\n    case 'exit':\n      if (metadata.contract === 'PROXY_ACTIONS_DSR') return lang.formatString(\"\".concat(lang[langKey].withdrawing_gem).concat(suffix), 'USDFL');else return '?';\n\n    case 'exitAll':\n      if (metadata.contract === 'PROXY_ACTIONS_DSR') return lang.formatString(\"\".concat(lang[langKey].withdrawing_gem).concat(suffix), 'all USDFL');else return '?';\n\n    case 'frob':\n      if (metadata.contract === 'PROXY_ACTIONS') return \"\".concat(lang[langKey].claiming_collateral).concat(suffix);else return '?';\n\n    default:\n      return '?';\n  }\n};\n\nexport var TransactionManagerContext = createContext({});\n\nfunction TransactionManagerProvider(_ref2) {\n  var children = _ref2.children;\n\n  var _useMaker = useMaker(),\n      maker = _useMaker.maker;\n\n  var _useLanguage = useLanguage(),\n      lang = _useLanguage.lang;\n\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      transactions = _useState2[0],\n      setTransactions = _useState2[1];\n\n  var _useState3 = useState(true),\n      _useState4 = _slicedToArray(_useState3, 2),\n      txDrawExpanded = _useState4[0],\n      setTxDrawExpanded = _useState4[1];\n\n  useEffect(function () {\n    if (!maker) return;\n    var sub = maker.service('transactionManager').onTransactionUpdate(function (tx, state) {\n      setTxDrawExpanded(true);\n      state = state === 'mined' || state === 'finalized' ? 'success' : state;\n      var message = formatTxMessage(lang, tx, state);\n\n      if (state === 'initialized') {\n        setTransactions(function (txs) {\n          return [].concat(_toConsumableArray(txs), [{\n            id: uniqueId(tx._transaction),\n            tx: tx,\n            state: state,\n            message: message,\n            visible: true,\n            pending: true\n          }]);\n        });\n      } else {\n        setTransactions(function (current) {\n          var txIdx = findIndex(current, function (t) {\n            return t.id === uniqueId(tx._transaction);\n          });\n          current[txIdx].state = state;\n          current[txIdx].message = message;\n          current[txIdx].hash = tx.hash;\n          if (state === 'success') current[txIdx].success = true;\n          if (state === 'error' && !tx.hash) current[txIdx].rejected = true;\n          if (state === 'error' && tx.hash) current[txIdx].failed = true;\n          if (state === 'success' || state === 'error') current[txIdx].pending = false; // Auto dismiss after timeout if tx succeeded or was rejected\n\n          if (state === 'success' || state === 'error' && !tx.hash) {\n            current[txIdx].pendingRemoval = true;\n            setTimeout(function () {\n              setTransactions(function (current) {\n                var txIdx = findIndex(current, function (t) {\n                  return t.id === uniqueId(tx._transaction);\n                });\n                current[txIdx].visible = false;\n                return _toConsumableArray(current);\n              });\n            }, autoDismissTime + autoDismissFadeoutTime);\n          }\n\n          return _toConsumableArray(current);\n        });\n      }\n    });\n    return function () {\n      return sub.unsub();\n    };\n  }, [maker, lang]);\n  return /*#__PURE__*/React.createElement(TransactionManagerContext.Provider, {\n    value: {\n      transactions: transactions,\n      setTransactions: setTransactions,\n      txDrawExpanded: txDrawExpanded,\n      setTxDrawExpanded: setTxDrawExpanded\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 5\n    }\n  }, children);\n}\n\n__signature__(TransactionManagerProvider, \"useMaker{{ maker }}\\nuseLanguage{{ lang }}\\nuseState{[transactions, setTransactions]([])}\\nuseState{[txDrawExpanded, setTxDrawExpanded](true)}\\nuseEffect{}\", function () {\n  return [useMaker, useLanguage];\n});\n\nvar _default = TransactionManagerProvider;\nexport default _default;\n;\n\n(function () {\n  var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;\n\n  if (!reactHotLoader) {\n    return;\n  }\n\n  reactHotLoader.register(autoDismissTime, \"autoDismissTime\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/providers/TransactionManagerProvider.js\");\n  reactHotLoader.register(autoDismissFadeoutTime, \"autoDismissFadeoutTime\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/providers/TransactionManagerProvider.js\");\n  reactHotLoader.register(ValueText, \"ValueText\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/providers/TransactionManagerProvider.js\");\n  reactHotLoader.register(formatTxMessage, \"formatTxMessage\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/providers/TransactionManagerProvider.js\");\n  reactHotLoader.register(TransactionManagerContext, \"TransactionManagerContext\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/providers/TransactionManagerProvider.js\");\n  reactHotLoader.register(TransactionManagerProvider, \"TransactionManagerProvider\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/providers/TransactionManagerProvider.js\");\n  reactHotLoader.register(_default, \"default\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/providers/TransactionManagerProvider.js\");\n})();\n\n;\n\n(function () {\n  var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;\n  leaveModule && leaveModule(module);\n})();","map":{"version":3,"sources":["/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/providers/TransactionManagerProvider.js"],"names":["React","createContext","useState","useEffect","useMaker","prettifyCurrency","useLanguage","uniqueId","findIndex","txManager","styled","autoDismissTime","autoDismissFadeoutTime","ValueText","b","formatTxMessage","lang","state","metadata","tx","interfaceLocale","getInterfaceLanguage","formatAmount","amount","toBigNumber","type","method","action","name","langKey","suffix","hash","console","log","formatString","pay_back_dai","wipeAmount","generate_dai","drawAmount","get_reward","get_reward_all","unlock_pool","lock_pool","depositing_gem","lockAmount","symbol","withdrawing_gem","freeAmount","creating_cdp","deposit_generate","send","to","toLowerCase","substr","setting_up_proxy","unlocking_token","contract","claiming_collateral","TransactionManagerContext","TransactionManagerProvider","children","maker","transactions","setTransactions","txDrawExpanded","setTxDrawExpanded","sub","service","onTransactionUpdate","message","txs","id","_transaction","visible","pending","current","txIdx","t","success","rejected","failed","pendingRemoval","setTimeout","unsub"],"mappings":"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","sourcesContent":["import React, { createContext, useState } from 'react';\nimport { useEffect } from 'react';\nimport useMaker from 'hooks/useMaker';\nimport { prettifyCurrency } from 'utils/ui';\nimport useLanguage from 'hooks/useLanguage';\nimport { uniqueId } from 'utils/dev';\nimport findIndex from 'lodash/findIndex';\nimport { txManager } from 'references/config';\nimport styled from 'styled-components';\nconst { autoDismissTime, autoDismissFadeoutTime } = txManager;\n\nconst ValueText = styled.b`\n  font-weight: 600;\n`;\n\nconst formatTxMessage = (lang, { metadata, ...tx }, state) => {\n  const interfaceLocale = lang.getInterfaceLanguage();\n  const formatAmount = amount =>\n    prettifyCurrency(interfaceLocale, amount.toBigNumber(), 2);\n  const type = metadata?.method || metadata?.action?.name;\n  const langKey =\n    state === 'success' ? 'transactions_past_tense' : 'transactions';\n  const suffix =\n    state === 'error' && tx.hash\n      ? ' failed'\n      : state === 'error' && !tx.hash\n        ? ' cancelled'\n        : '';\n\n  console.log(type);\n  switch (type) {\n    case 'safeWipe':\n      return lang.formatString(\n        `${lang[langKey].pay_back_dai}${suffix}`,\n        <ValueText>{formatAmount(metadata.wipeAmount)}</ValueText>\n      );\n    case 'safeWipeAll':\n      return lang.formatString(\n        `${lang[langKey].pay_back_dai}${suffix}`,\n        'outstanding'\n      );\n    case 'draw':\n      return lang.formatString(\n        `${lang[langKey].generate_dai}${suffix}`,\n        <ValueText>{formatAmount(metadata.drawAmount)}</ValueText>\n      );\n    case 'claimReward':\n      return lang.formatString(\n        `${lang[langKey].get_reward}${suffix}`,\n        <ValueText></ValueText>\n      );\n    case 'claimRewardEx':\n      return lang.formatString(\n        `${lang[langKey].get_reward_all}${suffix}`,\n        <ValueText></ValueText>\n      );\n    case 'getReward':\n      return lang.formatString(\n        `${lang[langKey].get_reward}${suffix}`,\n        <ValueText></ValueText>\n      );\n    case 'withdraw':\n      return lang.formatString(\n        `${lang[langKey].unlock_pool}${suffix}`,\n        <ValueText></ValueText>\n      );\n    case 'stake':\n      return lang.formatString(\n        `${lang[langKey].lock_pool}${suffix}`,\n        <ValueText></ValueText>\n      );\n    case 'safeLockETH':\n    case 'safeLockGem':\n      return lang.formatString(\n        `${lang[langKey].depositing_gem}${suffix}`,\n        <>\n          <ValueText>{formatAmount(metadata.lockAmount)}</ValueText>{' '}\n          {metadata.lockAmount.symbol}\n        </>\n      );\n    case 'wipeAndFreeETH':\n    case 'wipeAndFreeGem':\n      return lang.formatString(\n        `${lang[langKey].withdrawing_gem}${suffix}`,\n        <>\n          <ValueText>{formatAmount(metadata.freeAmount)}</ValueText>{' '}\n          {metadata.freeAmount.symbol}\n        </>\n      );\n    case 'openLockETHAndDraw':\n    case 'openLockGemAndDraw':\n      return lang.formatString(\n        `${lang[langKey].creating_cdp}${suffix}`\n        // <><ValueText>{formatAmount(metadata.lockAmount)}</ValueText> {(lockAmount.symbol)}</>\n      );\n    case 'lockETHAndDraw':\n    case 'lockGemAndDraw':\n      return lang.formatString(\n        `${lang[langKey].deposit_generate}${suffix}`,\n        <>\n          <ValueText>{formatAmount(metadata.drawAmount)}</ValueText>{' '}\n          {metadata.drawAmount.symbol}\n        </>\n      );\n    case 'transfer':\n      return lang.formatString(\n        `${lang[langKey].send}${suffix}`,\n        <>\n          <ValueText>{formatAmount(metadata.action.amount)}</ValueText>{' '}\n          {metadata.action.amount.symbol}\n        </>,\n        <>\n          <ValueText>{metadata.action.to.toLowerCase().substr(0, 5)}</ValueText>\n          ...\n          <ValueText>{metadata.action.to.toLowerCase().substr(-3)}</ValueText>\n        </>\n      );\n    case 'build':\n      return lang.formatString(`${lang[langKey].setting_up_proxy}${suffix}`);\n    case 'approve':\n      return lang.formatString(\n        `${lang[langKey].unlocking_token}${suffix}`,\n        metadata.contract === 'MCD_DAI' ? 'USDFL' : 'token'\n      );\n    case 'join':\n      if (metadata.contract === 'PROXY_ACTIONS_DSR')\n        return lang.formatString(\n          `${lang[langKey].depositing_gem}${suffix}`,\n          'USDFL'\n        );\n      else return '?';\n    case 'exit':\n      if (metadata.contract === 'PROXY_ACTIONS_DSR')\n        return lang.formatString(\n          `${lang[langKey].withdrawing_gem}${suffix}`,\n          'USDFL'\n        );\n      else return '?';\n    case 'exitAll':\n      if (metadata.contract === 'PROXY_ACTIONS_DSR')\n        return lang.formatString(\n          `${lang[langKey].withdrawing_gem}${suffix}`,\n          'all USDFL'\n        );\n      else return '?';\n    case 'frob':\n      if (metadata.contract === 'PROXY_ACTIONS')\n        return `${lang[langKey].claiming_collateral}${suffix}`;\n      else return '?';\n    default:\n      return '?';\n  }\n};\n\nexport const TransactionManagerContext = createContext({});\n\nfunction TransactionManagerProvider({ children }) {\n  const { maker } = useMaker();\n  const { lang } = useLanguage();\n  const [transactions, setTransactions] = useState([]);\n  const [txDrawExpanded, setTxDrawExpanded] = useState(true);\n\n  useEffect(() => {\n    if (!maker) return;\n\n    const sub = maker\n      .service('transactionManager')\n      .onTransactionUpdate((tx, state) => {\n        setTxDrawExpanded(true);\n        state = state === 'mined' || state === 'finalized' ? 'success' : state;\n        const message = formatTxMessage(lang, tx, state);\n\n        if (state === 'initialized') {\n          setTransactions(txs => [\n            ...txs,\n            {\n              id: uniqueId(tx._transaction),\n              tx,\n              state,\n              message,\n              visible: true,\n              pending: true\n            }\n          ]);\n        } else {\n          setTransactions(current => {\n            const txIdx = findIndex(\n              current,\n              t => t.id === uniqueId(tx._transaction)\n            );\n            current[txIdx].state = state;\n            current[txIdx].message = message;\n            current[txIdx].hash = tx.hash;\n\n            if (state === 'success') current[txIdx].success = true;\n            if (state === 'error' && !tx.hash) current[txIdx].rejected = true;\n            if (state === 'error' && tx.hash) current[txIdx].failed = true;\n            if (state === 'success' || state === 'error')\n              current[txIdx].pending = false;\n\n            // Auto dismiss after timeout if tx succeeded or was rejected\n            if (state === 'success' || (state === 'error' && !tx.hash)) {\n              current[txIdx].pendingRemoval = true;\n              setTimeout(() => {\n                setTransactions(current => {\n                  const txIdx = findIndex(\n                    current,\n                    t => t.id === uniqueId(tx._transaction)\n                  );\n                  current[txIdx].visible = false;\n                  return [...current];\n                });\n              }, autoDismissTime + autoDismissFadeoutTime);\n            }\n\n            return [...current];\n          });\n        }\n      });\n\n    return () => sub.unsub();\n  }, [maker, lang]);\n\n  return (\n    <TransactionManagerContext.Provider\n      value={{\n        transactions,\n        setTransactions,\n        txDrawExpanded,\n        setTxDrawExpanded\n      }}\n    >\n      {children}\n    </TransactionManagerContext.Provider>\n  );\n}\n\nexport default TransactionManagerProvider;\n"]},"metadata":{},"sourceType":"module"}