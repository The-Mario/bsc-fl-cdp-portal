{"ast":null,"code":"import _regeneratorRuntime from \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\n(function () {\n  var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;\n  enterModule && enterModule(module);\n})();\n\nvar __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {\n  return a;\n};\n\nimport { useEffect, useState } from 'react';\nimport useActionState from 'hooks/useActionState';\nimport useMaker from 'hooks/useMaker';\nimport { watch } from 'hooks/useObservable';\nimport usePrevious from 'hooks/usePrevious';\nimport debug from 'debug';\nvar log = debug('maker:useProxy');\nexport default function useProxy() {\n  var _useMaker = useMaker(),\n      maker = _useMaker.maker,\n      account = _useMaker.account;\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      startedWithoutProxy = _useState2[0],\n      setStartedWithoutProxy = _useState2[1];\n\n  var _useState3 = useState(0),\n      _useState4 = _slicedToArray(_useState3, 2),\n      startingBlockHeight = _useState4[0],\n      setStartingBlockHeight = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      proxyDeployed = _useState6[0],\n      setProxyDeployed = _useState6[1];\n\n  var proxyAddress = watch.proxyAddress(account === null || account === void 0 ? void 0 : account.address);\n  var prevProxy = usePrevious(proxyAddress);\n  useEffect(function () {\n    if (prevProxy === undefined && proxyAddress === null) {\n      setStartedWithoutProxy(true);\n    }\n  }, [proxyAddress, prevProxy]);\n\n  var _useActionState = useActionState( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    var txPromise, txMgr;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            log('proxy setup is running');\n\n            if (account) {\n              _context.next = 3;\n              break;\n            }\n\n            return _context.abrupt(\"return\", null);\n\n          case 3:\n            if (!proxyAddress) {\n              _context.next = 5;\n              break;\n            }\n\n            return _context.abrupt(\"return\", proxyAddress);\n\n          case 5:\n            txPromise = maker.service('proxy').ensureProxy();\n            txMgr = maker.service('transactionManager');\n            txMgr.listen(txPromise, {\n              mined: function mined(tx) {\n                setStartingBlockHeight(tx._blockNumberWhenMined);\n              },\n              confirmed: function confirmed() {\n                setProxyDeployed(true);\n              },\n              error: function error() {\n                setStartingBlockHeight(0);\n              }\n            });\n            _context.next = 10;\n            return txMgr.confirm(txPromise, 10);\n\n          case 10:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }))),\n      _useActionState2 = _slicedToArray(_useActionState, 4),\n      setupProxy = _useActionState2[0],\n      proxyLoading = _useActionState2[1],\n      proxyErrors = _useActionState2[3];\n\n  return {\n    proxyAddress: proxyAddress,\n    startedWithoutProxy: startedWithoutProxy,\n    setupProxy: setupProxy,\n    proxyLoading: proxyLoading,\n    initialProxyCheck: proxyAddress === undefined,\n    proxyErrors: proxyErrors,\n    startingBlockHeight: startingBlockHeight,\n    proxyDeployed: proxyDeployed,\n    hasProxy: startedWithoutProxy ? proxyDeployed : !!proxyAddress\n  };\n}\n\n__signature__(useProxy, \"useMaker{{ maker, account }}\\nuseState{[startedWithoutProxy, setStartedWithoutProxy](false)}\\nuseState{[startingBlockHeight, setStartingBlockHeight](0)}\\nuseState{[proxyDeployed, setProxyDeployed](false)}\\nusePrevious{prevProxy}\\nuseEffect{}\\nuseActionState{[setupProxy, proxyLoading, , proxyErrors]}\", function () {\n  return [useMaker, usePrevious, useActionState];\n});\n\n;\n\n(function () {\n  var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;\n\n  if (!reactHotLoader) {\n    return;\n  }\n\n  reactHotLoader.register(log, \"log\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/hooks/useProxy.js\");\n  reactHotLoader.register(useProxy, \"useProxy\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/hooks/useProxy.js\");\n})();\n\n;\n\n(function () {\n  var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;\n  leaveModule && leaveModule(module);\n})();","map":{"version":3,"sources":["/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/hooks/useProxy.js"],"names":["useEffect","useState","useActionState","useMaker","watch","usePrevious","debug","log","useProxy","maker","account","startedWithoutProxy","setStartedWithoutProxy","startingBlockHeight","setStartingBlockHeight","proxyDeployed","setProxyDeployed","proxyAddress","address","prevProxy","undefined","txPromise","service","ensureProxy","txMgr","listen","mined","tx","_blockNumberWhenMined","confirmed","error","confirm","setupProxy","proxyLoading","proxyErrors","initialProxyCheck","hasProxy"],"mappings":"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","sourcesContent":["import { useEffect, useState } from 'react';\nimport useActionState from 'hooks/useActionState';\nimport useMaker from 'hooks/useMaker';\nimport { watch } from 'hooks/useObservable';\nimport usePrevious from 'hooks/usePrevious';\nimport debug from 'debug';\nconst log = debug('maker:useProxy');\n\nexport default function useProxy() {\n  const { maker, account } = useMaker();\n  const [startedWithoutProxy, setStartedWithoutProxy] = useState(false);\n  const [startingBlockHeight, setStartingBlockHeight] = useState(0);\n  const [proxyDeployed, setProxyDeployed] = useState(false);\n\n  const proxyAddress = watch.proxyAddress(account?.address);\n  const prevProxy = usePrevious(proxyAddress);\n\n  useEffect(() => {\n    if (prevProxy === undefined && proxyAddress === null) {\n      setStartedWithoutProxy(true);\n    }\n  }, [proxyAddress, prevProxy]);\n\n  const [setupProxy, proxyLoading, , proxyErrors] = useActionState(async () => {\n    log('proxy setup is running');\n    if (!account) return null;\n    if (proxyAddress) return proxyAddress;\n\n    const txPromise = maker.service('proxy').ensureProxy();\n\n    const txMgr = maker.service('transactionManager');\n    txMgr.listen(txPromise, {\n      mined: tx => {\n        setStartingBlockHeight(tx._blockNumberWhenMined);\n      },\n      confirmed: () => {\n        setProxyDeployed(true);\n      },\n      error: () => {\n        setStartingBlockHeight(0);\n      }\n    });\n\n    await txMgr.confirm(txPromise, 10);\n  });\n\n  return {\n    proxyAddress,\n    startedWithoutProxy,\n    setupProxy,\n    proxyLoading,\n    initialProxyCheck: proxyAddress === undefined,\n    proxyErrors,\n    startingBlockHeight,\n    proxyDeployed,\n    hasProxy: startedWithoutProxy ? proxyDeployed : !!proxyAddress\n  };\n}\n"]},"metadata":{},"sourceType":"module"}