{"ast":null,"code":"'use strict';\n\n(function () {\n  var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;\n  enterModule && enterModule(module);\n})();\n\nvar __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {\n  return a;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _regenerator = require('babel-runtime/regenerator');\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _slicedToArray2 = require('babel-runtime/helpers/slicedToArray');\n\nvar _slicedToArray3 = _interopRequireDefault(_slicedToArray2);\n\nvar _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nexports.default = function (maker, _) {\n  var _this = this;\n\n  var _ref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n      rpcUrl_ = _ref.rpcUrl;\n\n  var WALLETLINK = 'walletlink';\n  var rpcUrl = rpcUrl_;\n  maker.service('accounts', true).addAccountType(WALLETLINK, function () {\n    var _ref2 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee(settings) {\n      var web3Service, CHAIN_ID, ETH_JSONRPC_URL, appName, walletLink, walletLinkProvider, _ref3, _ref4, address, setEngine, handleRequest, resetWallet;\n\n      return _regenerator2.default.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              resetWallet = function resetWallet() {\n                var self = this;\n\n                self._relay.connection.setSessionMetadata(\"__destroyed\", \"1\");\n\n                self._relay.connection.destroy();\n\n                self._relay.storage.clear();\n              };\n\n              handleRequest = function handleRequest(payload, next, end) {\n                var self = this;\n                if (payload.method === 'eth_unsubscribe') return next(); // Including the nonce throws an error \"couldn't find tx for nonce\"\n\n                if (Array.isArray(payload.params)) delete payload.params[0].nonce;\n                self.sendAsync(payload, function (err, result) {\n                  return result ? end(null, result.result) : end(err);\n                });\n              };\n\n              setEngine = function setEngine(engine) {\n                var self = this;\n                if (self.engine) return;\n                self.engine = engine;\n                engine.on('block', function (block) {\n                  self.currentBlock = block;\n                });\n                engine.on('start', function () {\n                  self.start();\n                });\n                engine.on('stop', function () {\n                  self.stop();\n                });\n              };\n\n              web3Service = maker.service('web3');\n              CHAIN_ID = web3Service.networkId();\n              ETH_JSONRPC_URL = rpcUrl ? rpcUrl : web3Service.rpcUrl;\n              appName = 'Oasis App';\n              walletLink = new _walletlink2.default({\n                appName: appName\n              });\n              walletLinkProvider = walletLink.makeWeb3Provider(ETH_JSONRPC_URL, CHAIN_ID);\n              _context.next = 11;\n              return walletLinkProvider.enable();\n\n            case 11:\n              _ref3 = _context.sent;\n              _ref4 = (0, _slicedToArray3.default)(_ref3, 1);\n              address = _ref4[0];\n              walletLinkProvider.setEngine = setEngine;\n              walletLinkProvider.handleRequest = handleRequest;\n              walletLinkProvider.resetWallet = resetWallet;\n              return _context.abrupt('return', {\n                subprovider: walletLinkProvider,\n                address: address\n              });\n\n            case 18:\n            case 'end':\n              return _context.stop();\n          }\n        }\n      }, _callee, _this);\n    }));\n\n    return function (_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }());\n};\n\nvar _walletlink = require('walletlink');\n\nvar _walletlink2 = _interopRequireDefault(_walletlink);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\n;\n\n(function () {\n  var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;\n\n  if (!reactHotLoader) {\n    return;\n  }\n\n  reactHotLoader.register(_regenerator2, \"_regenerator2\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/node_modules/@makerdao/dai-plugin-walletlink/index.js\");\n  reactHotLoader.register(_slicedToArray3, \"_slicedToArray3\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/node_modules/@makerdao/dai-plugin-walletlink/index.js\");\n  reactHotLoader.register(_asyncToGenerator3, \"_asyncToGenerator3\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/node_modules/@makerdao/dai-plugin-walletlink/index.js\");\n  reactHotLoader.register(_walletlink2, \"_walletlink2\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/node_modules/@makerdao/dai-plugin-walletlink/index.js\");\n  reactHotLoader.register(_interopRequireDefault, \"_interopRequireDefault\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/node_modules/@makerdao/dai-plugin-walletlink/index.js\");\n})();\n\n;\n\n(function () {\n  var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;\n  leaveModule && leaveModule(module);\n})();","map":null,"metadata":{},"sourceType":"script"}