{"ast":null,"code":"import _slicedToArray from \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectSpread from \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _regeneratorRuntime from \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\n(function () {\n  var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;\n  enterModule && enterModule(module);\n})();\n\nvar __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {\n  return a;\n};\n\nimport round from 'lodash/round';\nimport { ETH } from '../maker';\nimport BigNumber from 'bignumber.js';\nimport Web3 from 'web3';\nexport function padRight(string, chars, sign) {\n  return string + new Array(chars - string.length + 1).join(sign ? sign : '0');\n}\nexport function toHex(str) {\n  var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n      _ref$with0x = _ref.with0x,\n      with0x = _ref$with0x === void 0 ? true : _ref$with0x,\n      _ref$rightPadding = _ref.rightPadding,\n      rightPadding = _ref$rightPadding === void 0 ? 64 : _ref$rightPadding;\n\n  var result = '';\n\n  for (var i = 0; i < str.length; i++) {\n    result += str.charCodeAt(i).toString(16);\n  }\n\n  if (rightPadding > 0) result = padRight(result, rightPadding);\n  return with0x ? '0x' + result : result;\n}\nexport function addressAsNumber(address) {\n  return parseInt(address.slice(2, 10), 16);\n}\nexport function isMissingContractAddress(call) {\n  if (call.target === undefined) {\n    console.error(\"Address for \".concat(call.call, \" not found\"));\n    return true;\n  }\n\n  return false;\n}\nexport var toNum = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(promise) {\n    var val;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return promise;\n\n          case 2:\n            val = _context.sent;\n            return _context.abrupt(\"return\", val.toBigNumber().toFixed());\n\n          case 4:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function toNum(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}(); //TODO add new token here (its for hardware wallet)\n\nexport var addTokenBalances = /*#__PURE__*/function () {\n  var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(account) {\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.t0 = _objectSpread;\n            _context2.t1 = {};\n            _context2.t2 = account;\n            _context2.t3 = round;\n            _context2.next = 6;\n            return toNum(window.maker.getToken(ETH).balanceOf(account.address));\n\n          case 6:\n            _context2.t4 = _context2.sent;\n            _context2.t5 = (0, _context2.t3)(_context2.t4, 2);\n            _context2.t6 = {\n              ethBalance: _context2.t5\n            };\n            return _context2.abrupt(\"return\", (0, _context2.t0)(_context2.t1, _context2.t2, _context2.t6));\n\n          case 10:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n\n  return function addTokenBalances(_x2) {\n    return _ref3.apply(this, arguments);\n  };\n}();\nexport var isValidAddressString = function isValidAddressString(addressString) {\n  return /^0x([A-Fa-f0-9]{40})$/.test(addressString);\n};\nexport var isValidTxString = function isValidTxString(txString) {\n  return /^0x([A-Fa-f0-9]{64})$/.test(txString);\n};\nexport var etherscanLink = function etherscanLink(string) {\n  var network = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'mainnet';\n  var pathPrefix = network === 'mainnet' ? '' : \"\".concat(network, \".\");\n  if (isValidAddressString(string)) return \"https://\".concat(pathPrefix, \"etherscan.io/address/\").concat(string);else if (isValidTxString(string)) return \"https://\".concat(pathPrefix, \"etherscan.io/tx/\").concat(string);else throw new Error(\"Can't create Etherscan link for \\\"\".concat(string, \"\\\"\"));\n};\nexport function checkEthereumProvider() {\n  return _checkEthereumProvider.apply(this, arguments);\n}\n\nfunction _checkEthereumProvider() {\n  _checkEthereumProvider = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n    var provider, web3, networkId, address;\n    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            if (!(typeof window.ethereum !== 'undefined')) {\n              _context4.next = 6;\n              break;\n            }\n\n            _context4.next = 3;\n            return window.ethereum.enable();\n\n          case 3:\n            provider = window.ethereum;\n            _context4.next = 11;\n            break;\n\n          case 6:\n            if (!window.web3) {\n              _context4.next = 10;\n              break;\n            }\n\n            provider = window.web3.currentProvider;\n            _context4.next = 11;\n            break;\n\n          case 10:\n            throw new Error('No web3 provider detected');\n\n          case 11:\n            web3 = new Web3(provider);\n            _context4.next = 14;\n            return web3.eth.net.getId();\n\n          case 14:\n            networkId = _context4.sent;\n            _context4.next = 17;\n            return web3.eth.getAccounts();\n\n          case 17:\n            address = _context4.sent[0];\n            return _context4.abrupt(\"return\", {\n              networkId: networkId,\n              address: address\n            });\n\n          case 19:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4);\n  }));\n  return _checkEthereumProvider.apply(this, arguments);\n}\n\nexport function browserEthereumProviderAddress() {\n  return _browserEthereumProviderAddress.apply(this, arguments);\n}\n\nfunction _browserEthereumProviderAddress() {\n  _browserEthereumProviderAddress = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n    var provider, addresses;\n    return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            if (!(typeof window.ethereum !== 'undefined')) {\n              _context5.next = 4;\n              break;\n            }\n\n            provider = window.ethereum;\n            _context5.next = 9;\n            break;\n\n          case 4:\n            if (!window.web3) {\n              _context5.next = 8;\n              break;\n            }\n\n            provider = window.web3.currentProvider;\n            _context5.next = 9;\n            break;\n\n          case 8:\n            return _context5.abrupt(\"return\", null);\n\n          case 9:\n            if (!(provider.selectedAddress && typeof provider.selectedAddress === 'string')) {\n              _context5.next = 11;\n              break;\n            }\n\n            return _context5.abrupt(\"return\", provider.selectedAddress.toLowerCase());\n\n          case 11:\n            _context5.next = 13;\n            return new Web3(provider).eth.getAccounts();\n\n          case 13:\n            addresses = _context5.sent;\n            return _context5.abrupt(\"return\", addresses.length > 0 ? addresses[0].toLowerCase() : null);\n\n          case 15:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, _callee5);\n  }));\n  return _browserEthereumProviderAddress.apply(this, arguments);\n}\n\nexport function isEthereumProviderApproved() {\n  return _isEthereumProviderApproved.apply(this, arguments);\n}\n\nfunction _isEthereumProviderApproved() {\n  _isEthereumProviderApproved = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6() {\n    var provider, addresses;\n    return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            if (!(typeof window.ethereum !== 'undefined')) {\n              _context6.next = 4;\n              break;\n            }\n\n            provider = window.ethereum;\n            _context6.next = 9;\n            break;\n\n          case 4:\n            if (!window.web3) {\n              _context6.next = 8;\n              break;\n            }\n\n            provider = window.web3.currentProvider;\n            _context6.next = 9;\n            break;\n\n          case 8:\n            return _context6.abrupt(\"return\", false);\n\n          case 9:\n            if (!provider.selectedAddress) {\n              _context6.next = 11;\n              break;\n            }\n\n            return _context6.abrupt(\"return\", true);\n\n          case 11:\n            _context6.next = 13;\n            return new Web3(provider).eth.getAccounts();\n\n          case 13:\n            addresses = _context6.sent;\n            return _context6.abrupt(\"return\", addresses.length > 0 ? true : false);\n\n          case 15:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, _callee6);\n  }));\n  return _isEthereumProviderApproved.apply(this, arguments);\n}\n\nexport function pollTokenPrices(maker, token) {\n  var CURRENT_PRICE_OSM_IDX = 3;\n  var NEXT_PRICE_OSM_IDX = 4;\n  var tokenOsmAddress = maker.service('smartContract').getContract(\"PIP_\".concat(token)).address;\n  return Promise.all([CURRENT_PRICE_OSM_IDX, NEXT_PRICE_OSM_IDX].map(function (storageIdx) {\n    return maker.service('web3').getStorageAt(tokenOsmAddress, storageIdx).then(function (res) {\n      return new BigNumber(res.substring(34, res.length), 16).shiftedBy(-18);\n    });\n  })).then(function (_ref4) {\n    var _ref5 = _slicedToArray(_ref4, 2),\n        currentPrice = _ref5[0],\n        nextPrice = _ref5[1];\n\n    return {\n      currentPrice: currentPrice,\n      nextPrice: nextPrice\n    };\n  });\n}\nexport var calculateGasCost = /*#__PURE__*/function () {\n  var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(maker) {\n    var gasLimit,\n        _gasLimit,\n        gasPrice,\n        _args3 = arguments;\n\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            gasLimit = _args3.length > 1 && _args3[1] !== undefined ? _args3[1] : 21000;\n            _gasLimit = BigNumber(gasLimit);\n            _context3.next = 4;\n            return maker.service('gas').getGasPrice('fast');\n\n          case 4:\n            gasPrice = _context3.sent;\n            return _context3.abrupt(\"return\", _gasLimit.times(gasPrice).shiftedBy(-18));\n\n          case 6:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n\n  return function calculateGasCost(_x3) {\n    return _ref6.apply(this, arguments);\n  };\n}();\n;\n\n(function () {\n  var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;\n\n  if (!reactHotLoader) {\n    return;\n  }\n\n  reactHotLoader.register(padRight, \"padRight\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/utils/ethereum.js\");\n  reactHotLoader.register(toHex, \"toHex\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/utils/ethereum.js\");\n  reactHotLoader.register(addressAsNumber, \"addressAsNumber\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/utils/ethereum.js\");\n  reactHotLoader.register(isMissingContractAddress, \"isMissingContractAddress\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/utils/ethereum.js\");\n  reactHotLoader.register(toNum, \"toNum\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/utils/ethereum.js\");\n  reactHotLoader.register(addTokenBalances, \"addTokenBalances\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/utils/ethereum.js\");\n  reactHotLoader.register(isValidAddressString, \"isValidAddressString\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/utils/ethereum.js\");\n  reactHotLoader.register(isValidTxString, \"isValidTxString\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/utils/ethereum.js\");\n  reactHotLoader.register(etherscanLink, \"etherscanLink\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/utils/ethereum.js\");\n  reactHotLoader.register(checkEthereumProvider, \"checkEthereumProvider\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/utils/ethereum.js\");\n  reactHotLoader.register(browserEthereumProviderAddress, \"browserEthereumProviderAddress\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/utils/ethereum.js\");\n  reactHotLoader.register(isEthereumProviderApproved, \"isEthereumProviderApproved\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/utils/ethereum.js\");\n  reactHotLoader.register(pollTokenPrices, \"pollTokenPrices\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/utils/ethereum.js\");\n  reactHotLoader.register(calculateGasCost, \"calculateGasCost\", \"/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/utils/ethereum.js\");\n})();\n\n;\n\n(function () {\n  var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;\n  leaveModule && leaveModule(module);\n})();","map":{"version":3,"sources":["/Users/good/Documents/Good/GitHub/FL/fork/bsc-fl-cdp-portal/src/utils/ethereum.js"],"names":["round","ETH","BigNumber","Web3","padRight","string","chars","sign","Array","length","join","toHex","str","with0x","rightPadding","result","i","charCodeAt","toString","addressAsNumber","address","parseInt","slice","isMissingContractAddress","call","target","undefined","console","error","toNum","promise","val","toBigNumber","toFixed","addTokenBalances","account","window","maker","getToken","balanceOf","ethBalance","isValidAddressString","addressString","test","isValidTxString","txString","etherscanLink","network","pathPrefix","Error","checkEthereumProvider","ethereum","enable","provider","web3","currentProvider","eth","net","getId","networkId","getAccounts","browserEthereumProviderAddress","selectedAddress","toLowerCase","addresses","isEthereumProviderApproved","pollTokenPrices","token","CURRENT_PRICE_OSM_IDX","NEXT_PRICE_OSM_IDX","tokenOsmAddress","service","getContract","Promise","all","map","storageIdx","getStorageAt","then","res","substring","shiftedBy","currentPrice","nextPrice","calculateGasCost","gasLimit","_gasLimit","getGasPrice","gasPrice","times"],"mappings":"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","sourcesContent":["import round from 'lodash/round';\nimport { ETH } from '../maker';\nimport BigNumber from 'bignumber.js';\nimport Web3 from 'web3';\n\nexport function padRight(string, chars, sign) {\n  return string + new Array(chars - string.length + 1).join(sign ? sign : '0');\n}\n\nexport function toHex(str, { with0x = true, rightPadding = 64 } = {}) {\n  let result = '';\n  for (let i = 0; i < str.length; i++) {\n    result += str.charCodeAt(i).toString(16);\n  }\n  if (rightPadding > 0) result = padRight(result, rightPadding);\n  return with0x ? '0x' + result : result;\n}\n\nexport function addressAsNumber(address) {\n  return parseInt(address.slice(2, 10), 16);\n}\n\nexport function isMissingContractAddress(call) {\n  if (call.target === undefined) {\n    console.error(`Address for ${call.call} not found`);\n    return true;\n  }\n  return false;\n}\n\nexport const toNum = async promise => {\n  const val = await promise;\n  return val.toBigNumber().toFixed();\n};\n\n//TODO add new token here (its for hardware wallet)\nexport const addTokenBalances = async account => {\n  return {\n    ...account,\n    ethBalance: round(\n      await toNum(window.maker.getToken(ETH).balanceOf(account.address)),\n      2\n    )\n  };\n};\n\nexport const isValidAddressString = addressString =>\n  /^0x([A-Fa-f0-9]{40})$/.test(addressString);\n\nexport const isValidTxString = txString =>\n  /^0x([A-Fa-f0-9]{64})$/.test(txString);\n\nexport const etherscanLink = (string, network = 'mainnet') => {\n  const pathPrefix = network === 'mainnet' ? '' : `${network}.`;\n  if (isValidAddressString(string))\n    return `https://${pathPrefix}etherscan.io/address/${string}`;\n  else if (isValidTxString(string))\n    return `https://${pathPrefix}etherscan.io/tx/${string}`;\n  else throw new Error(`Can't create Etherscan link for \"${string}\"`);\n};\n\nexport async function checkEthereumProvider() {\n  let provider;\n  if (typeof window.ethereum !== 'undefined') {\n    await window.ethereum.enable();\n    provider = window.ethereum;\n  } else if (window.web3) {\n    provider = window.web3.currentProvider;\n  } else {\n    throw new Error('No web3 provider detected');\n  }\n\n  const web3 = new Web3(provider);\n  const networkId = await web3.eth.net.getId();\n  const address = (await web3.eth.getAccounts())[0];\n\n  return { networkId, address };\n}\n\nexport async function browserEthereumProviderAddress() {\n  let provider;\n  if (typeof window.ethereum !== 'undefined') {\n    provider = window.ethereum;\n  } else if (window.web3) {\n    provider = window.web3.currentProvider;\n  } else return null;\n  if (\n    provider.selectedAddress &&\n    typeof provider.selectedAddress === 'string'\n  ) {\n    return provider.selectedAddress.toLowerCase();\n  }\n  const addresses = await new Web3(provider).eth.getAccounts();\n  return addresses.length > 0 ? addresses[0].toLowerCase() : null;\n}\n\nexport async function isEthereumProviderApproved() {\n  let provider;\n  if (typeof window.ethereum !== 'undefined') {\n    provider = window.ethereum;\n  } else if (window.web3) {\n    provider = window.web3.currentProvider;\n  } else return false;\n  if (provider.selectedAddress) return true;\n  const addresses = await new Web3(provider).eth.getAccounts();\n  return addresses.length > 0 ? true : false;\n}\n\nexport function pollTokenPrices(maker, token) {\n  const CURRENT_PRICE_OSM_IDX = 3;\n  const NEXT_PRICE_OSM_IDX = 4;\n\n  const tokenOsmAddress = maker\n    .service('smartContract')\n    .getContract(`PIP_${token}`).address;\n\n  return Promise.all(\n    [CURRENT_PRICE_OSM_IDX, NEXT_PRICE_OSM_IDX].map(storageIdx =>\n      maker\n        .service('web3')\n        .getStorageAt(tokenOsmAddress, storageIdx)\n        .then(res =>\n          new BigNumber(res.substring(34, res.length), 16).shiftedBy(-18)\n        )\n    )\n  ).then(([currentPrice, nextPrice]) => ({\n    currentPrice,\n    nextPrice\n  }));\n}\n\nexport const calculateGasCost = async (maker, gasLimit = 21000) => {\n  const _gasLimit = BigNumber(gasLimit);\n  const gasPrice = await maker.service('gas').getGasPrice('fast');\n  return _gasLimit.times(gasPrice).shiftedBy(-18);\n};\n"]},"metadata":{},"sourceType":"module"}